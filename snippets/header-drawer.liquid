{%- doc -%}
  Renders a header drawer menu triggered by the top details element.

  @param {object} linklist - The linklist to render
  @param {string} [class] - Additional classes to add to the drawer
  @param {string} [data_header_drawer_type] - The type of header drawer to render
  @param {object} [block] - The block that can be used to provide settings
  @param {object} [section] - The section that can be used to provide settings

  @example
  {% render 'header-drawer', linklist: section.settings.menu, class: 'header-drawer--mobile' %}
{%- enddoc -%}

{% liquid
  if block != blank
    assign block_settings = block.settings
  elsif section != blank
    assign block_settings = section.settings
  else
    assign block_settings = blank
  endif
  assign max_featured_items = 4
  if block_settings != blank and block_settings.image_border_radius != blank
    assign image_border_radius = block_settings.image_border_radius
  else
    assign image_border_radius = 0
  endif

  if block_settings != blank
    if block_settings.menu_style == 'featured_collections' and block_settings.featured_collections_aspect_ratio != blank
      assign ratio = block_settings.featured_collections_aspect_ratio
    elsif block_settings.menu_style == 'featured_products' and block_settings.featured_products_aspect_ratio != blank
      assign ratio = block_settings.featured_products_aspect_ratio
    endif
  endif

  ##
  # We only eager load heavy elements of the page when rendering this template
  # through the Section Rendering API.
  #
  # This keeps the initial render lightweight, minimizing the impact on TTFB.
  # The second render then refreshes the page with additional content.
  #
  # At the moment, we check if the Section Rendering API is being used by
  # checking if section.index is blank.
  assign eager_loading = false
  if section.index == blank
    assign eager_loading = true
  endif
%}

<script
  src="{{ 'header-drawer.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

{{ 'component-menu-drawer.css' | asset_url | stylesheet_tag }}
{{ 'component-list-menu.css' | asset_url | stylesheet_tag }}
{{ 'component-list-social.css' | asset_url | stylesheet_tag }}

<header-drawer
  class="header-drawer {{ class }}"
  style="--menu-image-border-radius: {{ image_border_radius }}px; --resource-card-corner-radius: {{ image_border_radius }}px;"
>
  <details
    id="Details-menu-drawer-container"
    data-skip-node-update="true"
    class="menu-drawer-container"
    ref="details headerMenu"
    scroll-lock
  >
    <summary
      class="header__icon header__icon--menu header__icon--summary"
      aria-label="{{ 'accessibility.menu' | t }}"
      on:click="/toggle"
    >
      <span class="svg-wrapper header-drawer-icon header-drawer-icon--open">
        {{- 'icon-menu.svg' | inline_asset_content -}}
      </span>
      <span class="svg-wrapper header-drawer-icon header-drawer-icon--close">
        {{- 'icon-close.svg' | inline_asset_content -}}
      </span>
    </summary>
    <div
      data-header-drawer
      class="
        menu-drawer
        motion-reduce
        {% if block_settings != blank and block_settings.color_scheme != blank %}color-{{ block_settings.color_scheme }}{% endif %}
      "
    >
      <button
        class="button button-unstyled close-button menu-drawer__close-button"
        type="button"
        aria-label="{{ 'actions.close' | t }}"
        on:click="/close"
      >
        <span class="svg-wrapper header-drawer-icon header-drawer-icon--close">
          {{- 'icon-close.svg' | inline_asset_content -}}
        </span>
      </button>
      <nav
        class="menu-drawer__navigation"
        style="
          {%- if block_settings != blank -%}
            {%- render 'menu-font-styles', settings: block_settings, menu_type: 'drawer' %}
            {%- render 'submenu-font-styles', settings: block_settings %}
          {%- endif -%}
        "
      >
{% comment %}
  Mobile Sidebar Drawer - Unified Rewrite
  Integrates Main Menu, Footer Menu (for Categories/Products), Custom Links, and Account Actions.
{% endcomment %}

<nav class="menu-drawer__navigation">
  <ul class="menu-drawer__menu has-submenu list-menu" role="list">
    

    
    {%- comment -%} 
      SECTION: ALL CATEGORIES (COLLECTIONS)
      Iterating over all collections as requested.
    {%- endcomment -%}
    <li class="menu-drawer__section-title">Categorie</li>
    {%- comment -%} 
      SECTION: ALL CATEGORIES (Native Menu)
      Replaced custom collection loop with Shopify "Main Menu" iteration.
    {%- endcomment -%}

    
    {%- if linklist != blank -%}
      {%- assign menu_handle = linklist.handle | default: linklist -%}
      {%- if menu_handle == 'main-menu' -%}{%- assign menu_handle = 'sidebar-menu' -%}{%- endif -%}
      {%- for link in linklists[menu_handle].links -%}
        <li>
          {%- if link.links != blank -%}
            <details id="Details-menu-drawer-menu-item-{{ forloop.index }}">
              <summary class="menu-drawer__menu-item list-menu__item link link--text focus-inset{% if link.child_active %} menu-drawer__menu-item--active{% endif %}">
                {{ link.title | escape }}
                <span class="svg-wrapper">
                  {{- 'icon-arrow.svg' | inline_asset_content -}}
                </span>
                <span class="svg-wrapper">
                  {{- 'icon-caret.svg' | inline_asset_content -}}
                </span>
              </summary>
              <div id="link-{{ link.handle | escape }}" class="menu-drawer__submenu has-submenu gradient motion-reduce" tabindex="-1">
                <div class="menu-drawer__inner-submenu">
                  <button class="menu-drawer__close-button link link--text focus-inset" aria-expanded="true">
                    {{- 'icon-arrow.svg' | inline_asset_content -}}
                    {{ link.title | escape }}
                  </button>
                  <ul class="menu-drawer__menu list-menu" role="list" tabindex="-1">
                    {%- for childlink in link.links -%}
                      <li>
                        {%- if childlink.links == blank -%}
                          <a href="{{ childlink.url }}" class="menu-drawer__menu-item list-menu__item link link--text focus-inset{% if childlink.current %} menu-drawer__menu-item--active{% endif %}"{% if childlink.current %} aria-current="page"{% endif %}>
                            {{ childlink.title | escape }}
                          </a>
                        {%- else -%}
                          <details id="Details-menu-drawer-submenu-{{ forloop.index }}">
                            <summary class="menu-drawer__menu-item list-menu__item link link--text focus-inset">
                              {{ childlink.title | escape }}
                              <span class="svg-wrapper">
                                {{- 'icon-arrow.svg' | inline_asset_content -}}
                              </span>
                              <span class="svg-wrapper">
                                {{- 'icon-caret.svg' | inline_asset_content -}}
                              </span>
                            </summary>
                            <div id="childlink-{{ childlink.handle | escape }}" class="menu-drawer__submenu has-submenu gradient motion-reduce">
                              <button class="menu-drawer__close-button link link--text focus-inset" aria-expanded="true">
                                {{- 'icon-arrow.svg' | inline_asset_content -}}
                                {{ childlink.title | escape }}
                              </button>
                              <ul class="menu-drawer__menu list-menu" role="list" tabindex="-1">
                                {%- for grandchildlink in childlink.links -%}
                                  <li>
                                    <a href="{{ grandchildlink.url }}" class="menu-drawer__menu-item list-menu__item link link--text focus-inset{% if grandchildlink.current %} menu-drawer__menu-item--active{% endif %}"{% if grandchildlink.current %} aria-current="page"{% endif %}>
                                      {{ grandchildlink.title | escape }}
                                    </a>
                                  </li>
                                {%- endfor -%}
                              </ul>
                            </div>
                          </details>
                        {%- endif -%}
                      </li>
                    {%- endfor -%}
                  </ul>
                </div>
              </div>
            </details>
          {%- else -%}
            <a href="{{ link.url }}" class="menu-drawer__menu-item list-menu__item link link--text focus-inset{% if link.current %} menu-drawer__menu-item--active{% endif %}"{% if link.current %} aria-current="page"{% endif %}>
              {%- comment -%} Determine Icon based on Handle {%- endcomment -%}
              {%- assign icon_name = 'ph-circle' -%}
              {%- assign handle = link.handle | handleize -%}
              {%- case handle -%}
                {%- when 'search' -%}{%- assign icon_name = 'ph-magnifying-glass' -%}
                {%- when 'catalogo' -%}{%- assign icon_name = 'ph-grid-four' -%}
                {%- when 'all-collections' -%}{%- assign icon_name = 'ph-grid-four' -%}
                {%- when 'alimentazione' -%}{%- assign icon_name = 'ph-carrot' -%}
                {%- when 'animali' -%}{%- assign icon_name = 'ph-paw-print' -%}
                {%- when 'casa' -%}{%- assign icon_name = 'ph-house' -%}
                {%- when 'orders' -%}{%- assign icon_name = 'ph-package' -%}
                {%- when 'profile' -%}{%- assign icon_name = 'ph-user' -%}
              {%- endcase -%}
              <i class="ph {{ icon_name }} menu-drawer__icon"></i>
              {{ link.title | escape }}
            </a>
          {%- endif -%}
        </li>
      {%- endfor -%}
    {%- endif -%}

  </ul>
</nav>

      {%- comment -%} 
        No Accounts / Socials as requested.
      {%- endcomment -%}
      <div class="menu-drawer__utility-links" style="display: none;"></div>
    </div>
    <div
      class="menu-drawer__backdrop"
      on:click="/close"
    ></div>
  </details>
</header-drawer>

